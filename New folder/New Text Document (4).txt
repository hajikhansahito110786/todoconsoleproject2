<div id="chatbox" style="border:1px solid #ccc; padding:10px; width:400px; height:300px; overflow-y:auto; margin-bottom:10px;"></div>
<input type="text" id="userInput" placeholder="Ask something..." style="width:300px;">
<button onclick="sendMessage()">Send</button>

<script>
function sendMessage() {
    var userText = document.getElementById('userInput').value.trim();
    if (!userText) return;
    var chatbox = document.getElementById('chatbox');
    chatbox.innerHTML += "<div><b>You:</b> " + userText + "</div>";
    document.getElementById('userInput').value = '';
    fetch(window.location.pathname, {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'question=' + encodeURIComponent(userText)
    })
    .then(response => response.text())
    .then(data => {
        chatbox.innerHTML += "<div><b>AI:</b> " + data + "</div>";
        chatbox.scrollTop = chatbox.scrollHeight;
    });
}
document.getElementById('userInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') sendMessage();
});
</script>
"

$output = json_decode($response, true);
echo htmlspecialchars($output['candidates'][0]['content']['parts'][0]['text'] ?? "No response from AI.");

$question = $_POST['question'];
$sql1="select * from gen where autonumber like '%$question%' or subject like '%$question%' or olddiary 
like '%$question%' or recfrom like '%$question%' or subject like '%$question%' or name SOUNDS LIKE '%$question%' or remarks
like '%$question%' or staff like '%$question%' or name like '%$question%' or fileletter 
like '%$question%'  or important like '%$question%'  or sentto like '%$question%'  or sentdate 
like '%$question%' or username like '%$question%' or remarks like '%$question%' order by recdate desc LIMIT 5"; 



//   $result = $conn->query("SELECT * FROM gen ORDER BY autonumber DESC LIMIT 5");

//$entries .= $row['autonumber'] . ": " . $row['subject'] . "\n";
$entries .= $row['autonumber'] . ": " . $row['subject'] . ": " . $row['recfrom'] .": " . $row['sentto'] .": " . $row['sentdate'] .                       "\n";

$question = $_POST['question'];
$sql = "SELECT * FROM gen WHERE subject LIKE '%$question%' OR content LIKE '%$question%' ORDER BY id DESC LIMIT 5";
$result = $conn->query($sql);
